{% extends "base.html" %}
{% block title %}Film Â· {{ film.title if film else 'Not found' }}{% endblock %}
{% block content %}
{% if not film %}
  <div class="alert alert-danger">Film not found.</div>
  <a class="btn btn-secondary" href="{{ url_for('films_list') }}">Back</a>
{% else %}
<div class="row g-3">
  <div class="col-lg-8">
    <div class="card p-3">
      <h5>Edit film</h5>
      <form method="post">
        <div class="row g-2">
          <div class="col-md-8">
            <label class="form-label">Title</label>
            <input class="form-control" name="title" value="{{ film.title }}" required>
          </div>
          <div class="col-md-4">
            <label class="form-label">Release year</label>
            <input class="form-control" name="release_year" type="number" value="{{ film.release_year or '' }}">
          </div>
          <div class="col-md-6">
            <label class="form-label">Language</label>
            <select name="language_id" class="form-select">
              {% for l in languages %}
                <option value="{{ l.language_id }}" {{ 'selected' if l.language_id==film.language_id else '' }}>{{ l.name }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label">Category</label>
            <select name="category_id" class="form-select">
              <option value="" {{ 'selected' if not film.category_id else '' }}>Select a category...</option>
              
              {% for c in categories %}
                <option value="{{ c.category_id }}" {{ 'selected' if c.category_id == film.category_id else '' }}>
                  {{ c.name }}
                </option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label">Rating</label>
            <select name="rating" class="form-select">
              {% for r in ['G','PG','PG-13','R','NC-17'] %}
                <option value="{{ r }}" {{ 'selected' if film.rating==r else '' }}>{{ r }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-4">
            <label class="form-label">Rental rate</label>
            <input class="form-control" name="rental_rate" type="number" step="0.01" value="{{ film.rental_rate }}">
          </div>
          <div class="col-md-4">
            <label class="form-label">Length (min)</label>
            <input class="form-control" name="length" type="number" value="{{ film.length or '' }}">
          </div>
          <div class="col-md-4">
            <label class="form-label">Replacement cost</label>
            <input class="form-control" name="replacement_cost" type="number" step="0.01" value="{{ film.replacement_cost }}">
          </div>
          <div class="col-md-4">
            <label class="form-label">Rental duration (days)</label>
            <input class="form-control" name="rental_duration" type="number" value="{{ film.rental_duration }}">
          </div>
          <div class="col-12">
            <label class="form-label">Description</label>
            <textarea class="form-control" name="description" rows="4">{{ film.description or '' }}</textarea>
          </div>
        </div>
        <div class="mt-3">
          <button class="btn btn-primary" type="submit">Save</button>
          <a class="btn btn-secondary" href="{{ url_for('films_list') }}">Back</a>
        </div>
      </form>
    </div>
  </div>

  <div class="col-lg-4">
    <div class="card p-3">
      <h5>Actors</h5>
      <ul class="list-group mb-3">
        {% for a in actors %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            {{ a.first_name }} {{ a.last_name }}
            <form method="post" action="{{ url_for('remove_actor', film_id=film.film_id, actor_id=a.actor_id) }}">
              <button class="btn btn-sm btn-outline-danger">Remove</button>
            </form>
          </li>
        {% endfor %}
        {% if actors|length == 0 %}
          <li class="list-group-item"><em>No actors yet</em></li>
        {% endif %}
      </ul>
      <form method="post" action="{{ url_for('add_actor', film_id=film.film_id) }}" class="row g-2">
        <div class="col-8">
          <select class="form-select" name="actor_id">
            {% for a in available_actors %}
              <option value="{{ a.actor_id }}">{{ a.first_name }} {{ a.last_name }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-4">
          <button class="btn btn-success w-100" type="submit">Add</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endif %}
{% endblock %}

